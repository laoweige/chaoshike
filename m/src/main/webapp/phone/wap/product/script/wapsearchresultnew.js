/* suning.com 1417789153898 */function subString(a,e,r,s){for(var i=0,o="",t=/[^\x00-\xff]/g,n="",c=a.replace(t,"**").length,d=0;c>d&&(n=a.charAt(d).toString(),null!=n.match(t)?(i+=2,r&&e++):i++,!(i>e));d++)o+=n;return s&&c>e&&(o+="..."),o}function bindSearchBtn(){$("#wapSearchURL").unbind(),$("#wapSearchURL").on("click",function(){var a=$("#wapSearchInput").val();trim(a)&&(location.href="/search/result.html?keyword="+wapFormatURL(trim(a)))})}function showMsg(){SUI.Use("AlertBox",{type:"mini",msg:"很抱歉，暂不支持查看套餐商品详情"})}function renderPromotionLabel(a){var e=$("#"+a).attr("name");"true"!=$("#"+a).attr("loading")&&"true"!=$("#"+a).attr("isDone")&&($("#"+a).attr("loading","true"),$.ajax({url:e,type:"get",dataType:"json",async:!0,success:function(e){var r,s=e.isBigPolyHui,i=e.activityList;if($mPromotionLabel=$('<em class="saleIcons"></em>'),"undefined"!=typeof i&&null!=i)for(var o=0;o<i.length;o++){var t=i[o].activityTypeId;if("1"===t){$mPromotionLabel.append('<span class="jiang">抢</span>');var n=Number.parseFloat(i[o].salesPrice);isNaN(n)||("undefined"==typeof r?r=n:r-n>=0&&(r=n))}if("2"===t){$mPromotionLabel.append('<span class="jiang">团</span>');var n=i[o].salesPrice,n=Number.parseFloat(i[o].salesPrice);isNaN(n)||("undefined"==typeof r?r=n:r-n>=0&&(r=n))}"3"===t&&$mPromotionLabel.append('<span class="quan">券</span>'),"4"===t&&$mPromotionLabel.append('<span class="quan">降</span>'),"101"===t&&$mPromotionLabel.append('<span class="quan">预</span>')}"TRUE"===s&&$mPromotionLabel.append('<span class="jiang">聚</span>'),"undefined"!=typeof r&&$("#sprice"+a).html('<span class="orange">&yen;'+r.toFixed(2)+"</span>"),$("#sp"+a).append($mPromotionLabel),$("#"+a).attr("loading",""),$("#"+a).attr("isDone","true")},error:function(){}}))}function renderYuyueLabel(a){var e=$("#"+a).attr("app-url");if("true"!=$("#"+a).attr("loading")&&"true"!=$("#"+a).attr("isDone")){$("#"+a).attr("loading","true");var r=$("#"+a).attr("app-data");"undefined"!=r&&null!=r&&r.length>0&&$.ajax({type:"POST",url:e,dataType:"jsonp",jsonpCallback:"sCatProm",async:!1,success:function(e){var s=e;if($mPromotionLabel=$('<em class="saleIcons"></em>'),s&&null!=s.vendor){""==s.vendor&&(s.vendor="0000000000");for(var i=r.split("#"),o=0;o<i.length;o++)if(s.vendor==i[o]){$mPromotionLabel.append('<span class="quan">预</span>');break}}$("#sp"+a).append($mPromotionLabel),$("#"+a).attr("loading",""),$("#"+a).attr("isDone","true"),loadYuyueLabel(LOAD_YUYUE_LIS)},error:function(){loadYuyueLabel(LOAD_YUYUE_LIS)}})}}function lazyloadPromotionLabel(a){var e=null;$(a).find("li").each(function(){var a=$(this).attr("id"),e=$(this)[0];e.offsetTop<window.innerHeight&&renderPromotionLabel(a)}),window.addEventListener("scroll",function(){e=setTimeout(function(){$(a).find("li").each(function(){var a=$(this).attr("id"),r=$(this)[0],s=r.offsetTop,i=window.innerHeight||window.screen.height;return window.pageYOffset>s+i||window.pageYOffset<s-i?void clearTimeout(e):void(window.pageYOffset>s-i&&renderPromotionLabel(a))})},300)},!1)}function loadYuyueLabel(a){if(a.length){var e=$(a.shift()),r=e.attr("id");renderYuyueLabel(r)}}function lazyloadYuyueLabel(a){LOAD_YUYUE_LIS||(LOAD_YUYUE_LIS=Array.prototype.slice.call($(a).find("li"),0)),loadYuyueLabel(LOAD_YUYUE_LIS)}function noData(){$("#headBox").hide(),$("#productsListArea").hide(),$("#more_load").hide();var a=$("#noResultMsg"),e='<p>抱歉,没有找到<span class="orange"></span>相关商品</p>';a.html(e),a.show()}function loadData(a,e){$("#reGoodsDiv").hide(),$("#noResultMsg").hide(),$("#productsListArea").show(),$("#searchFilter").show();var r=a;"1"==r?lazyloadPromotionLabel(".productsList"):lazyloadYuyueLabel(".productsList"),e>20&&($("#more_load").show(),$("#more_load").find("a").html("点击加载更多"),searcher.isTop=!0),searcher.filter.initialize()}var searcher={initialize:function(){var a=this;searcher.searchParams.cityId=9017;var e=$("#keyword").val(),r=$("#categoryId").val();null!=e&&e.length>0&&(a.searchParams.keyword=unescape(trim(e))),null!=r&&r.length>0&&(a.searchParams.ci=r,a.searchParams.keyword="")},searchParams:{cityId:"",keyword:"",cp:0,ps:20,st:0,set:5,cf:"",iv:-1,ci:"",ct:-1,yuyue:-1,n:2},rSearchParams:{cityId:"",parameter:"",sceneIds:"10-7",count:6},isTop:!1,queryData:function(a,e,r,s){var i=this;$(".keywordsBox").hide(),$("#reGoodsDiv").hide(),LOAD_YUYUE_LIS&&(LOAD_YUYUE_LIS=void 0),$.ajax({url:"http://search.suning.com/emall/mobile/mobileSearch.jsonp",data:i.searchParams,type:"post",dataType:"jsonp",async:!0,success:function(o){var t;if(t=null!=o&&null!=o.goodsCount?parseInt(o.goodsCount,10)||0:0){$("#reGoodsDiv").hide(),$("#noResultMsg").hide(),$("#productsListArea").show(),$("#searchFilter").show(),0==oneload?i.utils.parseProductList(o.goods,e):oneload=0;var n=o.isInvokePromotion;"1"==n?lazyloadPromotionLabel(".productsList"):lazyloadYuyueLabel(".productsList"),t>i.searchParams.ps&&($("#more_load").show(),$("#more_load").find("a").html("点击加载更多"),searcher.isTop=!0),i.utils.initPage({pageCurrent:parseInt(i.searchParams.cp)+1,pageSize:i.searchParams.ps,totalCount:t}),a&&i.utils.constructFilters(o.filters),r&&searcher.filter.initialize()}else{s&&$("#headBox").hide(),$("#productsListArea").hide(),$("#more_load").hide();var c=$("#noResultMsg");c.show(),c.empty();var d='<p>抱歉,没有找到<span class="orange">“'+searcher.searchParams.keyword+"”</span>相关商品</p>";searcher.searchParams.keyword||(d=d.replace("“”","")),c.html(d),i.queryRecommendGoods()}},error:function(){var a=$("#noResultMsg");a.show(),a.html("系统繁忙,请稍后再试!"),$("#searchFilter").hide()}})},filter:{initialize:function(){var a=this;a.filterBox(),a.filterGroupFold(),a.radioGroup()},filterBox:function(){var a=this,e=$(".J_filter"),r=$(".filterBox"),s=r.find(".closeBtn");e.bind("touchend click",function(){var a=$("#mask");a.length<1&&($("body").append('<div id="mask" class="mask"></div>'),$("body").css({overflow:"hidden"})),r.animate({right:0},500,function(){s.show()}).show()}),s.bind("click",function(){$("#mask").remove(),$("body").css({overflow:"auto"}),r.animate({right:"-5.2rem",display:"none"},500,function(){s.hide()})}),$(".filterSubmit").unbind(),$(".filterSubmit").bind("touchend click",function(){$("#mask").remove(),$("body").css({overflow:"auto"}),r.animate({right:"-5.2rem"},500,function(){s.fadeOut(200)}),a.filterSubmit()})},filterGroupFold:function(){$(".filterGroup").each(function(a,e){var r=$(e).children(".listRadioGroup").find("label").size(),s=$(e).find(".foldBtn");s.hide(),r>6?(s.show(),$(e).addClass("fold")):(s.hide(),$(e).removeClass("fold")),s.bind("click",function(){$(e).hasClass("fold")?($(e).addClass("unfold"),$(e).removeClass("fold")):($(e).addClass("fold"),$(e).removeClass("unfold"))})})},radioGroup:function(){$(".J_radioGroup").each(function(a,e){var r=$(e).find("input[type='radio']");r.click(function(a){$(a.currentTarget).parent("label").click(function(){$(this).hasClass("cur")?$(this).removeClass("cur"):$(this).addClass("cur").siblings("label").removeClass("cur")})})})},filterSubmit:function(){searcher.searchParams.cf="";var a="",e=$("#filterGroups"),r=e.find("label");$.each(r,function(){var e=$(this);e.hasClass("cur")&&(a+=a.length>0?","+e.children("input").attr("id"):e.children("input").attr("id"))}),searcher.searchParams.iv=$("#ivCheck").attr("checked")?1:-1,searcher.searchParams.ct=$("#isCt").attr("checked")?1:-1,""!=a&&(searcher.searchParams.cf=a),searcher.searchParams.cp=0;var s='<li id="loading"><div class="sn-html5-loading" style="margin:100px auto;"><div class="blueball"></div><div class="orangeball"></div></div></li>';$("#productsList").html(s),searcher.queryData()}},sorter:function(){var a=this;$("#goodSort").find("li").click(function(){var e=$(this),r=e.index();if(2==r)e.hasClass("cur")?e.hasClass("down")?(e.removeClass("down").addClass("up"),a.searchParams.st=9):e.hasClass("up")&&(e.removeClass("up").addClass("down"),a.searchParams.st=10):(e.removeClass("up").addClass("down"),a.searchParams.st=10);else{if(e.hasClass("cur"))return!1;switch(r){case 0:a.searchParams.st=0;break;case 1:a.searchParams.st=8;break;default:a.searchParams.st=0}}e.addClass("cur").siblings().removeClass("cur"),a.searchParams.cp=0;var s='<li id="loading"><div class="sn-html5-loading" style="margin:100px auto;"><div class="blueball"></div><div class="orangeball"></div></div></li>';$("#productsList").html(s),a.queryData(!1,!1)})},changeCity:function(a){if(searcher.searchParams.cityId=a,searcher.searchParams.cp=0,searcher.searchParams.cf=$("#cf").val(),searcher.searchParams.iv=-1,0==oneload2){var e='<li id="loading"><div class="sn-html5-loading" style="margin:100px auto;"><div class="blueball"></div><div class="orangeball"></div></div></li>';$("#productsList").html(e)}else oneload2=0;searcher.queryData(!0,!1,!0,!0)},queryRecommendGoods:function(){searcher.rSearchParams.cityId=searcher.searchParams.cityId,searcher.rSearchParams.parameter=searcher.searchParams.keyword,$.ajax({url:"http://tuijian.suning.com/recommend-portal/recommendv2/biz.jsonp",type:"post",data:searcher.rSearchParams,dataType:"jsonp",success:function(a){var e=a.sugGoods[0];"02"!=e.resCode&&null!=e.skus&&e.skus.length>0&&(searcher.utils.constructRecommendGoods(e.skus),new SNTouch.ProList)},error:function(){$("#reGoodsDiv").hide()}})},utils:{parseProductList:function(a,e){var r,s=searcher.searchParams.cityId;r=e?$("#productsList"):$("#productsList").empty();var i="/spfs/querySalesShow_";$.each(a,function(a,e){var o=[];o.push(e.catentryId),o.push(e.partnumber),o.push("1"),o.push(s),o.push(""),o.push(e.activityId),o.push("WAP"),o.push(e.vendor);var t=encodeURIComponent(e.extenalFileds.orderInfo),n=i+o.join("_")+".html?orderInfo="+t,c="http://www.suning.com/emall/sprdpromon_10052_10051_",d=[];d.push(e.catentryId),d.push(s);var l=c+d.join("_")+"_.html",p=e.extenalFileds.orderInfo,u=$('<li id="'+e.catentryId+'" name="'+n+'" app-url="'+l+'" app-data="'+p+'"></li>'),h="/product/"+e.partnumber+".html";"9"==e.partnumber.charAt(0)&&(h="javascript:showMsg()");var m=$('<a href="'+h+'"></a>'),v=$('<div class="pro-list wbox"></div>'),f=getPriceImgUrl()+"/webapp/wcs/stores/prdprice/"+e.catentryId+"_"+searcher.searchParams.cityId+"_10000_10-1.png",g="000000000"+e.partnumber,y=getPrdImgUrl(g),b='<div class="pro-img"><img src="'+y+'" alt="'+e.catentdesc+'"></div>',P=$('<div class="pro-info wbox-flex"></div>'),L="<h3>"+e.catentdesc+"</h3>",w='<p class="desc">'+e.auxdescription+"</p>",I=$('<div class="priceInfo"></div>'),C=$('<div id="sp'+e.catentryId+'" class="m-price"></div>');f='<em>&yen;</em><img src="'+f+'" alt="" onerror="this.src=\'http://script.suning.cn/images/ShoppingArea/Common/blank.gif\'"/>';var k='<span id="sprice'+e.catentryId+'" class="price" >'+f+"</span>";C.append(k);var S=getPriceImgUrl()+"/webapp/wcs/stores/prdprice/"+e.catentryId+"_"+searcher.searchParams.cityId+"_10002_10-1.png",_="";e.supplierNum>1&&(_='<div class="o-price">共'+(0==e.supplierNum?1:e.supplierNum)+'个商家<em><i>&yen;</i> <img src="'+S+'" alt="" onerror="this.src=\'http://script.suning.cn/images/ShoppingArea/Common/blank.gif\'"/><i>起售</i></em></div>'),I.append(C).append(_),P.append(L).append(w).append(I),v.append(b).append(P),m.append(v),u.append(m),r.append(u)})},initPage:function(a){var e=parseInt(a.pageCurrent,10)||1,r=parseInt(a.pageSize,10)||20,s=parseInt(a.totalCount,10)||0,i=parseInt((s-1)/r+1);i>0&&(pageBox=$("#more_load"),i>e?(pageBox.find("a").unbind("click"),pageBox.find("a").bind("click",function(){searcher.searchParams.cp=e;var a='<a href="#"><div class="sn-html5-loading vm"><div class="blueball"></div><div class="orangeball"></div></div></a>';$(this).html(a),searcher.queryData(!1,!0)})):pageBox.hide()),i>0&&(searcher.isTop=i>e)},constructFilters:function(a){var e=$("#filterGroups");e.empty(),$.each(a,function(a,r){var s=$('<div class="filterGroup"></div>'),i='<div class="title">'+r.fieldNameDesc+"</div>",o=$('<div class="optionsList J_radioGroup listRadioGroup"></div>'),t='<div class="foldBtn"></div>';$.each(r.values,function(a,e){var r=$('<label><input name="colorSelector" type="radio" value="color1" id="'+e.value+'" />'+e.valueDesc+"</label>");o.append(r)}),s.append(i).append(o).append(t),e.append(s)})},constructRecommendGoods:function(a){$("#reGoodsDiv").show();var e=$("#reGoodList");e.empty(),$.each(a,function(a,r){var s=$("<li></li>"),i=$('<div class="otherProContent"></div>'),o=r.sugGoodsCode,t=getPrdSmallImgUrl(o),n="/product/"+r.sugGoodsCode+".html";"9"==o.charAt(9)&&(n="javascript:showMsg()");var c=$('<a href="'+n+'"></a>'),d='<div class="proImg"><img src="'+t+'" altr=""></div><p>'+r.sugGoodsName+"</p>";c.html(d),i.html(c),s.append(i),e.append(s)})}}},LOAD_YUYUE_LIS;$(function(){SNTouch.init(),searcher.initialize(),searcher.sorter(),bindSearchBtn();var a={};a.distNo=$.cookie("districtId")||"11365",a.cityNo=$.cookie("cityId")||"9173",a.provinceCode=$.cookie("provinceCode")||"100";var e=new Date;e.setTime(e.getTime()+432e5),SUI.UI.getCity({uid:"#city1",defaultCity:a,firstFlag:!0,distShowFlag:!1,getCityIdFirst:function(a){var e={provinceName:"江苏",provinceCode:"100",cityNo:"9173",cityName:"南京",distNo:"11365",distName:"玄武区"};a(e)},done:function(a){$.cookie("cityId",a.cityNo,{path:"/",domain:".suning.com",expires:e}),$.cookie("provinceCode",a.provinceCode,{path:"/",domain:".suning.com",expires:e}),searcher.changeCity(a.cityNo)}})});