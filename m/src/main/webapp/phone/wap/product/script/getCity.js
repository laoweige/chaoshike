/* suning.com 1417789153898 */var SUI=SUI||{};SUI.load.define("getCity",function(){return SUI.UI.getCity=function(t){function i(t){this.opts=t||{},this.uid=$(this.opts.uid)||$("#city1"),this.defaultCity=this.opts.defaultCity||{mdmId:"100",name:"江苏",commerceId:"100",defaultCityMdmId:"1000173",countryId:"",pinyin:"huadong_jiangsu",state:0,sequence:14},this.done=this.opts.done||function(){},this.getCityIdFirst=this.opts.getCityIdFirst||function(){},this.firstFlag=this.opts.firstFlag||!1,this.distShowFlag=this.opts.distShowFlag||!1,this.provinceUrl=this.opts.provinceUrl||"/getProvinceList/jsonp.html",this.cityUrl=this.opts.cityUrl||"/getCityList/jsonp/",this.districtUrl=this.opts.districtUrl||"/getDistrictList/jsonp/",this.pos=this.opts.pos||{};var i={};this.get=function(t){return i[t]},this.set=function(t,e){i[t]=e}}var e=!1,s=!1,c=!1,n=!1,a=!1;i.prototype={init:function(){var t=this;t.getAddressByDefault(t.getProvinceList)},getAddressByDefault:function(t){var i=this;i.firstFlag?(a=!0,i.set("geoCity",i.defaultCity),t.call(i,i.defaultCity)):(a=!1,e=!0,s=!0,c=!0,SUI.load.require("geo",function(e){e(function(e){i.getCityIdFirst(function(s){i.defaultCity=s,i.set("geoCity",e.addressComponent),t.call(i,s)})})}))},getProvinceList:function(t){var i=this,s=i.uid,c=i.get("geoCity");n=i.get("geoCity").ipFlag||!1,i.set("provinceUrl",i.provinceUrl),$.ajax({type:"GET",url:i.get("provinceUrl"),cache:!0,async:!1,dataType:"json",success:function(d){var o=i.firstFlag?t.provinceName:c.province,r='<div id="cb_provinceArea" class="sn-select-ui sn-select provinceArea"><div id="cb_pv" class="select-view">'+o+'</div><select id="provinceSelect"><option value="请选择省份">请选择省份</option><% for (var i = 0, l = provinceList.length; i < l; i ++) { %><option data-meta=\'<%=JSON.stringify(provinceList[i])%>\'><%=provinceList[i].provinceName%></option><% } %></select></div>',l=SUI.require("tmpl2").call(d,r,d);s.append(l),s.find("#provinceSelect").change(function(){var t=$(this).find("option:selected"),e=JSON.parse(t[0].dataset.meta);i.set("changeed",!0),i.getCityById(e,function(){SUI.require("main").selectBind()})}),e&&(e=!1,n||(o=o.substring(0,o.length-1)),s.find("#provinceSelect").find("option").each(function(){if($(this).val().indexOf(o)>=0){var t=JSON.parse($(this)[0].dataset.meta);i.getCityById(t,function(){SUI.require("main").selectBind()}),i.set("changeed",!1)}})),a&&s.find("#provinceSelect").find("option").each(function(){var e=$(this)[0];if(e.dataset.meta){var s=JSON.parse(e.dataset.meta);if(t.provinceCode==s.provinceCode)return $("#cb_pv").html(s.provinceName),s.cityNo=t.cityNo,i.distShowFlag&&(s.distNo=t.distNo),i.getCityById(s,function(){SUI.require("main").selectBind()}),i.set("changeed",!1),!1}})}})},getCityById:function(t,i){var e=this,c=e.uid;e.set("cityUrl",e.cityUrl+t.provinceCode+".html"),$.ajax({type:"GET",url:e.get("cityUrl"),cache:!0,async:!1,dataType:"json",success:function(d){var o;o=a?e.get("changeed")?"请选择城市":e.get("geoCity").cityName||"请选择城市":e.get("changeed")?"请选择城市":e.get("geoCity").city||"请选择城市";var r='<div id="cityArea" class="sn-select-ui sn-select cityArea"><div id="cb_cv" class="select-view">'+o+'</div><select id="cb_citySelect" class="citySelect"><option value="请选择城市">请选择城市</option><% for (var i = 0, l = cityList.length; i < l; i ++) { %><option data-meta=\'<%=JSON.stringify(cityList[i])%>\'><%=cityList[i].cityName%></option><% } %></select></div>',l=SUI.require("tmpl2").call(d,r,d);if(c.append(l),c.find("#cb_citySelect").length<=0?c.find("#cb_provinceArea").after(l):(c.find("#cityArea").remove(),c.find("#cb_provinceArea").after(l)),c.find("#cb_districtSelect").length>0&&c.find("#districtArea").remove(),"10"==t.provinceCode||"20"==t.provinceCode||"30"==t.provinceCode||"320"==t.provinceCode){switch($("#cityArea").hide(),t.provinceCode){case"10":t.cityNo="9017";break;case"20":t.cityNo="9264";break;case"30":t.cityNo="9281";break;case"320":t.cityNo="9325"}s?(s=!1,n||o==o.substring(0,o.length-1),c.find("#cb_citySelect").find("option").each(function(){if($(this).val().indexOf(o)>=0){var i=JSON.parse($(this)[0].dataset.meta);e.distShowFlag?e.getDistrictsById(i,function(){SUI.require("main").selectBind()}):SUI.require("main").selectBind(),e.set("changeed",!1),e.distShowFlag||e.done(t)}})):a?c.find("#cb_citySelect").find("option").each(function(){var i=$(this)[0];if(i.dataset.meta){var s=JSON.parse(i.dataset.meta);t.cityNo==s.cityNo&&($("#cb_cv").html(s.cityName),e.distShowFlag?e.getDistrictsById(s,function(){SUI.require("main").selectBind()}):SUI.require("main").selectBind(),e.set("changeed",!1),e.distShowFlag||e.done(t))}}):e.distShowFlag?e.getDistrictsById(t,function(){SUI.require("main").selectBind()}):SUI.require("main").selectBind()}else s?(s=!1,n||o==o.substring(0,o.length-1),c.find("#cb_citySelect").find("option").each(function(){if($(this).val().indexOf(o)>=0){var i=JSON.parse($(this)[0].dataset.meta);t=i,e.distShowFlag?e.getDistrictsById(t,function(){SUI.require("main").selectBind()}):SUI.require("main").selectBind(),e.set("changeed",!1),e.distShowFlag||e.done(t)}})):a&&c.find("#cb_citySelect").find("option").each(function(){var i=$(this)[0];if(i.dataset.meta){var s=JSON.parse(i.dataset.meta);t.cityNo==s.cityNo&&($("#cb_cv").html(s.cityName),e.distShowFlag?e.getDistrictsById(t,function(){SUI.require("main").selectBind()}):SUI.require("main").selectBind(),e.set("changeed",!1),e.distShowFlag||e.done(t))}}),c.find("#cb_citySelect").change(function(){var i=$(this).find("option:selected"),s=JSON.parse(i[0].dataset.meta);e.distShowFlag?e.getDistrictsById(s,function(){SUI.require("main").selectBind()}):(t.cityNo=s.cityNo,s.provinceCode=s.provinceCode,SUI.require("main").selectBind()),e.set("changeed",!0),e.distShowFlag||e.done(t)}),$("#cityArea").show();i()}})},getDistrictsById:function(t,i){var e=this,s=e.uid;e.set("districtUrl",e.districtUrl+t.cityNo+".html"),$.ajax({type:"GET",url:e.get("districtUrl"),cache:!0,async:!1,dataType:"json",success:function(n){function d(){$(window).width()<=320&&3==$(".select-address-list").children(s).find(".sn-select-ui:visible").size()?$(".sn-select-ui").last().addClass("block-or-not"):$(".sn-select-ui").last().removeClass("block-or-not")}var o=e.get("changeed")?"请选择区域":e.get("geoCity").district;o||(o="请选择区域");var r='<div id="districtArea" class="sn-select-ui sn-select districtArea"><div id="cb_dv" class="select-view">'+o+'</div><select id="cb_districtSelect" class="districtSelect"><option value="请选择区">请选择区</option><% for (var i = 0, l = districtList.length; i < l; i ++) { %><option data-meta=\'<%=JSON.stringify(districtList[i])%>\'><%=districtList[i].distName%></option><% } %></select></div>',l=SUI.require("tmpl2").call(n,r,n);s.find("#cb_districtSelect").length<=0?s.find("#cityArea").after(l):(s.find("#districtArea").remove(),s.find("#cityArea").after(l)),d(),$(window).resize(function(){d()});var h=s.find("#cb_districtSelect").find("option");o=o.substring(0,o.length),c?(c=!1,h.each(function(){var i=$(this)[0];if($(this).val().indexOf(o)>=0){var s=JSON.parse(i.dataset.meta);e.distShowFlag&&($("#cb_dv").html(s.distName),t.distNo=s.distNo),e.set("changeed",!1)}})):a&&h.each(function(i){var s=$(this)[0];if(s.dataset.meta){var c=JSON.parse(s.dataset.meta);if(e.defaultCity.distNo==c.distNo)return e.distShowFlag&&($("#cb_dv").html(c.distName),t.distNo=c.distNo),e.set("changeed",!1),!1;if(h.size()==i+1){var n=JSON.parse(h[1].dataset.meta);e.distShowFlag&&($("#cb_dv").html(n.distName),t.distNo=n.distNo),e.set("changeed",!1)}}}),s.find("#cb_districtSelect").change(function(){var i=$(this).find("option:selected"),s=JSON.parse(i[0].dataset.meta);e.distShowFlag&&e.set("changeed",!0),t.distNo=s.distNo,e.distShowFlag&&e.done(t)}),e.distShowFlag?($("#districtArea").show(),e.done(t)):($("#districtArea").hide(),a=!1),i()}})}},new i(t).init()},SUI.UI.getCity});